variables:
  - &docker_settings
    registry: ghcr.io
    repo: ghcr.io/${CI_REPO_OWNER}/esdock
    username: ${CI_REPO_OWNER}
    password:
      from_secret: REGISTRY_TOKEN

pipeline:
  # ---------------------------------------------------------
  # BUN
  # ---------------------------------------------------------
  publish-bun:
    image: woodpeckerci/plugin-docker
    settings:
      <<: *docker_settings
      context: bun
      dockerfile: bun/Dockerfile
      tags: bun
      platforms: linux/amd64,linux/arm64
    when:
      branch: master
      event: push
      path: { include: [ "bun/*" ] }

  # ---------------------------------------------------------
  # HTML
  # ---------------------------------------------------------
  publish-html:
    image: woodpeckerci/plugin-docker
    settings:
      <<: *docker_settings
      context: html
      dockerfile: html/Dockerfile
      tags: html
      platforms: linux/amd64,linux/arm64
    when:
      branch: master
      event: push
      path: { include: [ "html/*" ] }

  # ---------------------------------------------------------
  # JAVA
  # ---------------------------------------------------------
  publish-java:
    image: woodpeckerci/plugin-docker
    settings:
      <<: *docker_settings
      context: java
      dockerfile: java/${TAG}/Dockerfile
      tags: java_${TAG}
      platforms: linux/amd64,linux/arm64
    matrix:
      TAG: [16, 17, 18, 19, 20, 21, 22]
    when:
      branch: master
      event: push
      path: { include: [ "java/**" ] }

  # ---------------------------------------------------------
  # NODEJS
  # ---------------------------------------------------------
  publish-nodejs:
    image: woodpeckerci/plugin-docker
    settings:
      <<: *docker_settings
      context: nodejs
      dockerfile: nodejs/${TAG}/Dockerfile
      tags: nodejs_${TAG}
      platforms: linux/amd64,linux/arm64
    matrix:
      TAG: [12, 14, 16, 18, 20, 22]
    when:
      branch: master
      event: push
      path: { include: [ "nodejs/**" ] }

  # ---------------------------------------------------------
  # CHROME NODEJS - AMD64
  # ---------------------------------------------------------
  publish-chrnodejs:
    image: woodpeckerci/plugin-docker
    settings:
      <<: *docker_settings
      context: chrnodejs
      dockerfile: chrnodejs/${TAG}/Dockerfile
      tags: chrnodejs_${TAG}
      platforms: linux/amd64
    matrix:
      TAG: [12, 14, 16, 18, 20, 22]
    when:
      branch: master
      event: push
      path: { include: [ "chrnodejs/**" ] }
